<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Book an appointment</title>
  <link rel="stylesheet" href="..\css\styles.css" />
</head>
<body>
  <header class="header">
    <div class="container container-nav">
      <div class="site-title">
        <h1><a href="index.html" class="button">zcutz</a></h1>
      </div>
      <nav>
        <ul>
          <li><a href="index.html" class="current-page">Home</a></li>
          <li><a href="contactform.html">Book an appointment</a></li>
        </ul>
      </nav>
    </div>
  </header>

  <div class="container">
    <form id="appointment-form">
      <h3>Book an appointment</h3>
      <input type="text" id="name" placeholder="Name" class="textbox" />
      <!--name input ^-->
      <input type="email" id="email" placeholder="Email" class="email"/>
      <!--email input ^-->
      <input type="text" id="phone" placeholder="Phone Number" class="phoneno" />
      <!--phone no. input ^-->
      <select name="category" id="category" class="input-field">
        <option value="Choose your service">Choose your service</option>
      <!--service input ^-->
        <option value="Haircut">Haircut $25</option>
      </select>
      <input type="date" id="date" name="date" class="date" placeholder="Choose a date" onchange="updateTimeSlots()" />
      <!--date input ^ -->
      <select id="time" name="time" class="time">
        <!--time input with restricted availability, dynamically populated -->
      </select>
      <button type="button" class="confirm" onclick="sendMail()">Confirm appointment</button>
      <ion-icon name="arrow-forward" aria-hidden="true"></ion-icon>
    </form>
  </div>

<script src="https://cdn.jsdelivr.net/npm/@emailjs/browser@4/dist/email.min.js"></script>
<script type="text/javascript">
(function(){
  emailjs.init("tDhHIC_nIJktkKSyH");
})();

// Define your business hours
const businessHours = { start: 9, end: 17 };

// Function to update time slots based on selected date
function updateTimeSlots() {
  const selectedDate = new Date(document.getElementById("date").value);
  const currentTime = new Date();
  const timeSelect = document.getElementById("time");
  timeSelect.innerHTML = ""; // Clear existing options

  // Check if selected date is today
  if (selectedDate.toDateString() === currentTime.toDateString()) {
    const currentHour = currentTime.getHours();
    // Populate time slots starting from next available hour
    for (let i = Math.ceil(currentHour / 0.5) * 0.5; i <= businessHours.end; i += 0.5) {
      const option = document.createElement("option");
      const hour = (i % 12) || 12; // Convert to regular time
      const minutes = (i % 1) ? "30" : "00";
      const period = i < 12 ? 'AM' : 'PM';
      option.text = `${hour}:${minutes} ${period}`;
      option.value = `${hour}:${minutes} ${period}`;
      timeSelect.add(option);
    }
  } else {
    for (let i = businessHours.start; i <= businessHours.end; i++) {
      for (let j = 0; j < 2; j++) {
        const option = document.createElement("option");
        const hour = (i % 12) || 12; // Convert to regular time
        const minutes = (j === 0) ? "00" : "30";
        const period = i < 12 ? 'AM' : 'PM';
        option.text = `${hour}:${minutes} ${period}`;
        option.value = `${hour}:${minutes} ${period}`;
        timeSelect.add(option);
      }
    }
  }
}


function sendMail() {
    var params = {
        name: document.getElementById("name").value,
        email: document.getElementById("email").value, 
        phone: document.getElementById("phone").value,
        category: document.getElementById("category").value,
        date: document.getElementById("date").value,
        time: document.getElementById("time").value
    };

    const serviceID = "service_2ckei6k";
    const templateID = "template_6j6c08k";

    emailjs.send(serviceID, templateID, params)
    .then(function(res) {
        alert("Success! " + res.status);
    })
    .catch(function(err) {
        console.error("Failed to send email:", err);
        alert("Failed to send email: " + JSON.stringify(err));
    });

    var paramsForUser = {
        userName: params.name,
        userEmail: params.email,
        myEmail: "zc.utzzzz1@gmail.com", 
        businessPhone: "(304) 449-7012",
    };

    const userTemplateID = "template_z2f0uto";

    emailjs.send(serviceID, userTemplateID, paramsForUser)
    .then(function(res) {
        alert("Success! " + res.status);
    })
    .catch(function(err) {
        console.error("Failed to send email:", err);
        alert("Failed to send email: " + JSON.stringify(err));
    });
}

// Initial call to populate time slots
updateTimeSlots();
</script>
</body>
</html>
